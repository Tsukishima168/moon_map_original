# 月島甜點網站深度審核

本文件整理目前實作狀態與尚未覆蓋的項目，方便後續補齊。

---

## 一、已完成的項目（摘要）

- **彩蛋**：每月 renew 一次（依 `moonmoon_eggs_renew_month` 比對年月，自動清空讓大家重新找）。
- **僅甜點目錄網址**：`/menu` 路徑只顯示目錄 + 回首頁，購物車與結帳流程同上；可給 LINE 圖文選單、Dessert-Booking 共用。
- **訂單流程**：Supabase 寫入、UTM 儲存、備註、兩天後取貨與週一公休、LINE 跳轉與 fallback。
- **圖床**：Supabase `menu-images` 整合、`getMenuImageUrl()`、638×638 壓縮建議。
- **GA4**：purchase、add_to_cart、UTM landing、outbound 等。

---

## 二、LINE@ / LIFF 設定檢查清單

建議在 LINE Developers 與 LINE Official Account Manager 確認以下項目：

| 項目 | 說明 | 建議檢查 |
|------|------|----------|
| **LIFF ID** | `CONFIG.LINKS.liff_id`（目前為 `2008848603-ANGQX0GN`） | 與 LIFF 應用一致、Endpoint URL 為正式網域 |
| **LIFF Endpoint URL** | 部署後的網址（如 `https://moon-island.vercel.app`） | 需加入 LIFF 的「Endpoint URL」且與實際網域一致 |
| **網址白名單** | 若在 LINE 內開 LIFF，需設定可開的網域 | 將 `https://moon-island.vercel.app`、`https://*.vercel.app`（若用預覽）加入 |
| **官方帳號 @931cxefd** | 訂單完成後跳轉的 OA 連結（程式內 `line.me/R/oaMessage/@931cxefd/`） | 確認此 @ID 為正確的月島官方帳號 |
| **圖文選單 / 選單** | 一鍵開啟「只有甜點目錄」 | 選單按鈕可設為：`https://moon-island.vercel.app/menu`（僅目錄頁） |
| **預訂取貨連結** | CONFIG 內 `preorder_pickup_url`（ezpretty） | 若改用自站預訂，可改為 `/` 或 `/#menu` |
| **加入好友 / 客服** | `delivery_url`、`line_url`（lin.ee） | 確認為正確的加入好友或客服連結 |

**建議步驟：**

1. 登入 [LINE Developers Console](https://developers.line.biz/) → 選對 Channel → LIFF 分頁：確認 LIFF ID、Endpoint URL、Scopes。
2. 登入 [LINE Official Account Manager](https://manager.line.biz/) → 圖文選單 / 選單：新增「甜點目錄」連結到 `https://你的網域/menu`。
3. 實際在 LINE 內打開 LIFF 連結，測試登入（若有用）、選單、結帳後是否正確跳轉 OA。

---

## 三、訂單與結帳流程

| 項目 | 狀態 | 備註 |
|------|------|------|
| 最小取貨日（兩天後） | 已實作 | `getMinPickupDate()` |
| 週一公休鎖定 | 已實作 | `isMonday()`、日期選擇器 |
| 飲品僅店內 | 已實作 | 顯示但不開放預訂，點擊提示 |
| UTM 寫入 Supabase | 已實作 | `storedUTMParams` 寫入訂單 |
| 備註欄位 | 已實作 | `orderNote` 寫入 |
| LINE 跳轉（不擋彈窗） | 已調整 | 直接 `window.location.href`，失敗才 alert + 剪貼簿 |
| GA4 purchase | 已實作 | 結帳成功時觸發 |
| 錯誤處理 | 部分 | catch 時 `alert('發生錯誤，請稍後再試')`，未區分網路/權限/欄位 |

**可再補強：**

- 表單必填驗證（姓名、電話、日期）在送出前阻擋並提示。
- 訂單送出中顯示 loading（按鈕 disabled +「傳送中…」），避免重複送出。
- 錯誤時區分「網路錯誤」與「欄位錯誤」，並可重試。

---

## 四、錯誤頁與載入狀態

| 項目 | 狀態 | 建議 |
|------|------|------|
| **504 / Gateway Timeout** | 未特別處理 | Vercel 逾時多為後端或 Supabase 延遲；前端可：① 結帳按鈕設 timeout 後提示「連線逾時，請再試一次」② 若未來有 SSR，可設 504 專頁 |
| **404** | SPA 全導向 index.html | 未知路徑仍會進首頁；若需要可加 `/404` 路由或簡單 404 文案 |
| **菜單載入中** | 有 `menuLoading` | 已有；可確認載入失敗時是否有明確提示（例如「無法載入菜單，請重整」） |
| **結帳載入中** | 未顯式 | 建議 `confirmAndSend` 內 setLoading(true)，成功/失敗後 setLoading(false) |

---

## 五、SEO 與 Meta

- **index.html**：已有 title、description、keywords、og、twitter、favicon。
- **網址**：若正式網域與 `og:url` 不同，請改為正式網域。
- **JSON-LD / 結構化資料**：若需搜尋結果更豐富，可加 LocalBusiness 或 Product 的 JSON-LD（可參考 `AI_SEO_架構與關鍵字設計.md`）。

---

## 六、無障礙與體驗

- 部分按鈕/連結可補上 `aria-label`（尤其僅有圖示的）。
- 表單欄位建議加上 `label` 與 `id` 對應（部分已有）。
- 彩蛋進度、兌換券等若有重要資訊，可確保鍵盤可操作、focus 可見。

---

## 七、其他可檢視項目

| 項目 | 說明 |
|------|------|
| **Cookie / 同意** | 若之後放第三方 Cookie（如廣告），需有同意機制；目前 GA 等可依需求補簡短說明或橫幅 |
| **效能** | 圖片已用 Supabase + 638 建議；可再檢查 LCP、CLS（例如圖片定好寬高比） |
| **手機實測** | 建議用實機測：LIFF 內開站、結帳、LINE 跳轉、/menu 僅目錄 |
| **Supabase RLS** | 確認 `shop_orders`、`profiles` 等 policy 符合「僅允許必要寫入、讀取」 |
| **環境變數** | `VITE_SUPABASE_URL`、`VITE_SUPABASE_ANON_KEY` 僅用於前端，敏感操作應在後端或 Edge Function |

---

## 八、本輪已實作變更摘要

1. **彩蛋每月 renew**：localStorage 以 `moonmoon_eggs_renew_month`（YYYY-MM）比對，月份不同即清空 `moonmoon_found_eggs`，讓大家每月可重新找彩蛋。
2. **僅甜點目錄網址**：路徑 `/menu` 時以全螢幕 overlay 只顯示「月島甜點 | 甜點目錄」+ 回首頁 + 同一套目錄與購物車/結帳；`#menu` 仍會自動打開目錄 modal。
3. **深度審核**：本文件作為 LINE@、訂單、錯誤、SEO、無障礙與其他步驟的檢查清單，後續可依此逐項補齊或排程。

---

若你希望下一步實作某一項（例如表單驗證、結帳 loading、或 LINE 選單文案），可以指定項目我幫你寫進程式或補充到本文件。
