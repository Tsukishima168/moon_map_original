# 🎯 個人化推薦系統設計方案

## 📊 系統概覽

### 目標
基於用戶的**心情狀態**和 **MBTI 類型**，提供精準的甜點推薦，提升轉換率與用戶體驗。

### 核心價值
```
通用推薦 → 個人化推薦
   10% 轉換率 → 25% 轉換率（預期提升 150%）
```

---

## 🧠 推薦邏輯架構

### 三層推薦機制

```
Layer 1: 心情狀態推薦（輕度個人化）
   ↓
Layer 2: MBTI 類型推薦（深度個人化）
   ↓
Layer 3: 行為學習推薦（AI 個人化）
```

---

## 📋 Layer 1: 心情狀態推薦（已完成 ✅）

### 當前實作

```typescript
const STATE_DATA = {
  calm: {
    recommendedItems: [
      "烤布丁(附焦糖液)",
      "經典提拉米蘇", 
      "經典原味巴斯克"
    ]
  },
  // ... 其他狀態
};
```

### 推薦邏輯

| 心情狀態 | 推薦理由 | 商品特性 |
|---------|---------|---------|
| 平靜 (CALM) | 溫和、經典、不刺激 | 經典款、原味、溫潤 |
| 焦慮 (ANXIOUS) | 療癒、撫慰、甜蜜 | 布丁類、溫暖口感 |
| 希望 (HOPEFUL) | 清新、明亮、活力 | 柚子、鐵盒裝、千層 |
| 思考 (THINKING) | 深沉、專注、細膩 | 抹茶、原味、層次感 |
| 創作 (CREATIVE) | 獨特、創新、冒險 | 奶酒、特殊口味 |

### 優點
- ✅ 已上線運作
- ✅ 簡單易懂
- ✅ 快速決策

### 缺點
- ❌ 同一心情狀態的人看到相同推薦
- ❌ 無法區分個體差異
- ❌ 缺少學習機制

---

## 🎯 Layer 2: MBTI 類型推薦（建議實作）

### 系統架構

```typescript
// MBTI 16 型人格與甜點配對表
const MBTI_DESSERT_MAPPING = {
  // 分析家 (Analysts)
  INTJ: {
    personality: "建築師 - 戰略思考者",
    traits: ["理性", "獨立", "完美主義"],
    recommendedItems: [
      "抹茶提拉米蘇",           // 層次豐富，需細細品味
      "經典原味巴斯克",         // 精緻、極致的單純
      "經典十勝低糖千層"        // 理性的低糖選擇
    ],
    avoidItems: ["過甜", "過於華麗"],
    reason: "你追求完美與深度，這些甜點層次豐富卻不過分張揚"
  },
  
  INTP: {
    personality: "邏輯學家 - 創新思考者",
    traits: ["好奇", "分析", "靈活"],
    recommendedItems: [
      "日本柚子米蘇",           // 創新組合
      "烤布丁提拉米蘇",         // 經典的重新詮釋
      "蜜香紅茶巴斯克"          // 茶與甜點的融合實驗
    ],
    reason: "你喜歡探索新組合，這些創新口味會激發你的好奇心"
  },
  
  ENTJ: {
    personality: "指揮官 - 果斷領導者",
    traits: ["果斷", "高效", "目標導向"],
    recommendedItems: [
      "經典提拉米蘇鐵盒(600ml)", // 大份量、高效率
      "奶酒提拉米蘇",           // 濃郁、有力度
      "經典提拉米蘇"            // 經典不敗
    ],
    reason: "你喜歡經典且有影響力的選擇，這些甜點強勁而直接"
  },
  
  ENTP: {
    personality: "辯論家 - 聰明的惡魔代言人",
    traits: ["機智", "好辯", "熱情"],
    recommendedItems: [
      "日本柚子米蘇",           // 挑戰傳統
      "奶酒提拉米蘇",           // 大膽組合
      "抹茶提拉米蘇鐵盒(600ml)" // 驚喜份量
    ],
    reason: "你熱愛挑戰常規，這些創新口味符合你的冒險精神"
  },
  
  // 外交家 (Diplomats)
  INFJ: {
    personality: "提倡者 - 安靜的理想主義者",
    traits: ["理想", "敏感", "洞察"],
    recommendedItems: [
      "抹茶提拉米蘇",           // 細膩、有深度
      "蜜香紅茶巴斯克",         // 溫柔、療癒
      "烤布丁(附焦糖液)"        // 簡單卻有內涵
    ],
    reason: "你重視內在與意義，這些甜點含蓄而深刻"
  },
  
  INFP: {
    personality: "調停者 - 理想主義的治癒者",
    traits: ["溫柔", "創意", "同理心"],
    recommendedItems: [
      "烤布丁(附焦糖液)",       // 溫暖治癒
      "日本柚子米蘇",           // 清新柔和
      "蜜香紅茶巴斯克"          // 溫柔包容
    ],
    reason: "你的溫柔需要同樣溫暖的甜點來呼應"
  },
  
  ENFJ: {
    personality: "主人公 - 魅力領袖",
    traits: ["熱情", "負責", "利他"],
    recommendedItems: [
      "經典提拉米蘇鐵盒(600ml)", // 適合分享
      "日本柚子米蘇",           // 明亮、受歡迎
      "經典原味巴斯克"          // 經典、適合眾人
    ],
    reason: "你熱愛分享與連結，這些甜點適合與人共享"
  },
  
  ENFP: {
    personality: "競選者 - 自由的靈魂",
    traits: ["熱情", "創意", "自由"],
    recommendedItems: [
      "日本柚子米蘇",           // 活潑明亮
      "經典十勝低糖千層",       // 輕盈自由
      "奶酒提拉米蘇"            // 大膽嘗試
    ],
    reason: "你的自由精神需要同樣有趣的甜點來搭配"
  },
  
  // 守護者 (Sentinels)
  ISTJ: {
    personality: "物流師 - 實用的邏輯學家",
    traits: ["可靠", "務實", "負責"],
    recommendedItems: [
      "經典提拉米蘇",           // 經典可靠
      "經典原味巴斯克",         // 傳統正統
      "烤布丁(附焦糖液)"        // 實在穩定
    ],
    reason: "你信賴經典，這些傳統甜點經得起時間考驗"
  },
  
  ISFJ: {
    personality: "守衛者 - 貼心的保護者",
    traits: ["溫暖", "忠誠", "細心"],
    recommendedItems: [
      "烤布丁(附焦糖液)",       // 溫暖撫慰
      "蜜香紅茶巴斯克",         // 溫柔細膩
      "經典提拉米蘇"            // 經典可靠
    ],
    reason: "你的細心值得同樣用心製作的甜點"
  },
  
  ESTJ: {
    personality: "總經理 - 優秀的管理者",
    traits: ["高效", "組織", "傳統"],
    recommendedItems: [
      "經典提拉米蘇鐵盒(600ml)", // 高效大份量
      "經典提拉米蘇",           // 經典選擇
      "經典原味巴斯克"          // 傳統品質
    ],
    reason: "你重視效率與品質，這些經典款值得信賴"
  },
  
  ESFJ: {
    personality: "執政官 - 受歡迎的東道主",
    traits: ["熱心", "合群", "傳統"],
    recommendedItems: [
      "經典提拉米蘇鐵盒(600ml)", // 適合聚會
      "經典原味巴斯克",         // 眾人喜愛
      "烤布丁提拉米蘇"          // 兼容並蓄
    ],
    reason: "你善於照顧他人，這些甜點適合與朋友分享"
  },
  
  // 探險家 (Explorers)
  ISTP: {
    personality: "鑑賞家 - 大膽的實用主義者",
    traits: ["靈活", "理性", "冒險"],
    recommendedItems: [
      "奶酒提拉米蘇",           // 大膽嘗試
      "日本柚子米蘇",           // 創新組合
      "經典十勝低糖千層"        // 理性選擇
    ],
    reason: "你喜歡探索新事物，這些口味會帶來驚喜"
  },
  
  ISFP: {
    personality: "探險家 - 靈活的藝術家",
    traits: ["敏感", "藝術", "自由"],
    recommendedItems: [
      "抹茶提拉米蘇",           // 美學與風味並重
      "日本柚子米蘇",           // 清新藝術感
      "蜜香紅茶巴斯克"          // 柔美細膩
    ],
    reason: "你的藝術靈魂需要同樣美麗的甜點"
  },
  
  ESTP: {
    personality: "企業家 - 精力充沛的行動者",
    traits: ["大膽", "直接", "實際"],
    recommendedItems: [
      "奶酒提拉米蘇",           // 濃烈直接
      "經典提拉米蘇鐵盒(600ml)", // 豪邁大份
      "日本柚子米蘇"            // 刺激味蕾
    ],
    reason: "你的能量需要同樣強勁的甜點來匹配"
  },
  
  ESFP: {
    personality: "表演者 - 自發的娛樂者",
    traits: ["活潑", "熱情", "享樂"],
    recommendedItems: [
      "日本柚子米蘇",           // 明亮活潑
      "經典提拉米蘇鐵盒(600ml)", // 歡樂分享
      "奶酒提拉米蘇"            // 驚喜體驗
    ],
    reason: "你的熱情需要同樣歡樂的甜點來慶祝"
  }
};
```

### 實作方式

#### 1. 檢查用戶是否有 MBTI 資料

```typescript
// 從 Supabase 獲取用戶 MBTI
const user = supabase.auth.getUser();
const { data: profile } = await supabase
  .from('profiles')
  .select('mbti_type')
  .eq('email', user.email)
  .single();

const userMBTI = profile?.mbti_type; // 例如: 'INFJ'
```

#### 2. 結合心情狀態與 MBTI 推薦

```typescript
function getPersonalizedRecommendations(
  moodState: string, 
  mbtiType?: string
): string[] {
  // 如果有 MBTI，使用深度個人化推薦
  if (mbtiType && MBTI_DESSERT_MAPPING[mbtiType]) {
    return MBTI_DESSERT_MAPPING[mbtiType].recommendedItems;
  }
  
  // 否則使用心情狀態推薦
  return STATE_DATA[moodState].recommendedItems;
}
```

#### 3. UI 顯示差異化

```typescript
// 有 MBTI 的用戶
<div>
  <strong>🎯 專屬於 {MBTI_DESSERT_MAPPING[userMBTI].personality} 的你</strong>
  <p style={{ fontSize: '0.85rem', color: '#666' }}>
    {MBTI_DESSERT_MAPPING[userMBTI].reason}
  </p>
  {/* 推薦商品列表 */}
</div>

// 沒有 MBTI 的用戶
<div>
  <strong>為你推薦 RECOMMENDED</strong>
  <a href="mbti-lab-url" style={{ fontSize: '0.8rem' }}>
    完成 MBTI 測驗，獲得更精準推薦 →
  </a>
  {/* 推薦商品列表 */}
</div>
```

---

## 🤖 Layer 3: 行為學習推薦（未來優化）

### 數據收集

```typescript
// 追踪用戶行為
interface UserBehavior {
  user_id: string;
  
  // 瀏覽行為
  viewed_items: string[];
  view_duration: Record<string, number>;
  
  // 購買行為
  purchased_items: string[];
  purchase_frequency: Record<string, number>;
  
  // 互動行為
  clicked_items: string[];
  added_to_cart: string[];
  removed_from_cart: string[];
  
  // 心情記錄
  mood_history: Array<{
    state: string;
    timestamp: number;
  }>;
  
  // 偏好分析
  preferred_flavors: string[];      // 抹茶、柚子、原味...
  preferred_price_range: string;    // 100-200, 200-300...
  preferred_size: string;           // 小、中、大...
}
```

### AI 推薦算法

```typescript
// 協同過濾 (Collaborative Filtering)
// 找到相似用戶，推薦他們喜歡的商品

function getCollaborativeRecommendations(userId: string) {
  // 1. 找到相似用戶（相同 MBTI + 相似購買記錄）
  const similarUsers = findSimilarUsers(userId);
  
  // 2. 計算相似用戶喜歡但當前用戶未購買的商品
  const recommendations = calculateRecommendations(similarUsers, userId);
  
  // 3. 按照預測評分排序
  return recommendations.sort((a, b) => b.score - a.score);
}

// 內容推薦 (Content-Based Filtering)
// 根據用戶過去喜歡的商品特性，推薦類似商品

function getContentBasedRecommendations(userId: string) {
  // 1. 分析用戶購買過的商品特性
  const userProfile = analyzeUserPurchaseHistory(userId);
  
  // 2. 找到特性相似的未購買商品
  const similarItems = findSimilarItems(userProfile);
  
  // 3. 計算相似度評分
  return similarItems.sort((a, b) => b.similarity - a.similarity);
}
```

### 混合推薦策略

```typescript
function getHybridRecommendations(
  userId: string,
  moodState: string,
  mbtiType?: string
): string[] {
  const recommendations = [];
  
  // 30% 權重：心情狀態推薦
  const moodRecs = STATE_DATA[moodState].recommendedItems;
  recommendations.push(...moodRecs.map(item => ({ 
    item, 
    score: 0.3,
    source: 'mood' 
  })));
  
  // 40% 權重：MBTI 推薦
  if (mbtiType) {
    const mbtiRecs = MBTI_DESSERT_MAPPING[mbtiType].recommendedItems;
    recommendations.push(...mbtiRecs.map(item => ({ 
      item, 
      score: 0.4,
      source: 'mbti' 
    })));
  }
  
  // 30% 權重：行為學習推薦
  const behaviorRecs = getUserBehaviorRecommendations(userId);
  recommendations.push(...behaviorRecs.map(item => ({ 
    item, 
    score: 0.3,
    source: 'behavior' 
    })));
  
  // 合併去重，按總分排序
  return mergeAndRank(recommendations).slice(0, 3);
}
```

---

## 📊 推薦系統效益分析

### 轉換率提升預測

| 推薦層級 | 轉換率 | 提升幅度 | 實作難度 | 建議優先級 |
|---------|-------|---------|---------|-----------|
| 無推薦 | 5% | - | - | - |
| Layer 1 (心情) | 10% | +100% | ⭐ 低 | ✅ 已完成 |
| Layer 2 (MBTI) | 18% | +80% | ⭐⭐ 中 | 🔥 建議立即 |
| Layer 3 (AI) | 25% | +39% | ⭐⭐⭐ 高 | ⏰ 未來優化 |

### ROI 計算

```
假設數據：
• 月訪客：3000 人
• 完成心情測驗：40% (1200 人)
• 有 MBTI 資料：30% (360 人)

Layer 1 效益（已上線）：
• 轉換率：10%
• 訂單數：120 單
• 平均客單價：$300
• 月營收：$36,000

Layer 2 效益（MBTI 推薦）：
• MBTI 用戶轉換率：18%
• MBTI 用戶訂單：65 單
• 非 MBTI 用戶轉換率：8%
• 非 MBTI 用戶訂單：67 單
• 總訂單數：132 單
• 月營收：$39,600
• 營收提升：$3,600 (+10%)

開發成本：1-2 天
投資回報：第一個月即回本
```

---

## 🛠️ 實作計畫

### 階段一：MBTI 推薦系統（建議立即啟動）

#### 開發時間：1-2 天

#### 步驟 1：建立 MBTI 配對表（4 小時）
```typescript
// 在 index.tsx 中添加
const MBTI_DESSERT_MAPPING = { /* 上面的完整配對表 */ };
```

#### 步驟 2：獲取用戶 MBTI（2 小時）
```typescript
// 在 App 組件中
const [userMBTI, setUserMBTI] = useState<string | null>(null);

useEffect(() => {
  async function fetchUserMBTI() {
    if (user?.email) {
      const { data } = await supabase
        .from('profiles')
        .select('mbti_type')
        .eq('email', user.email)
        .single();
      
      setUserMBTI(data?.mbti_type);
    }
  }
  fetchUserMBTI();
}, [user]);
```

#### 步驟 3：更新推薦邏輯（2 小時）
```typescript
// 修改任務卡顯示推薦商品的部分
const recommendedItems = userMBTI && MBTI_DESSERT_MAPPING[userMBTI]
  ? MBTI_DESSERT_MAPPING[userMBTI].recommendedItems
  : STATE_DATA[selectedState].recommendedItems;

const recommendationReason = userMBTI && MBTI_DESSERT_MAPPING[userMBTI]
  ? MBTI_DESSERT_MAPPING[userMBTI].reason
  : null;
```

#### 步驟 4：UI 差異化顯示（2 小時）
```typescript
{/* 推薦區塊 */}
<div style={{ background: '#f5f5f5', padding: '15px', borderRadius: '8px', marginBottom: '20px' }}>
  {userMBTI ? (
    <>
      <strong style={{ display: 'block', fontSize: '0.9rem', marginBottom: '5px' }}>
        🎯 專屬於 {MBTI_DESSERT_MAPPING[userMBTI].personality} 的你
      </strong>
      <p style={{ fontSize: '0.85rem', color: '#666', marginBottom: '10px', fontStyle: 'italic' }}>
        {MBTI_DESSERT_MAPPING[userMBTI].reason}
      </p>
    </>
  ) : (
    <strong style={{ display: 'block', fontSize: '0.9rem', marginBottom: '10px' }}>
      為你推薦 RECOMMENDED
    </strong>
  )}
  
  {recommendedItems.map((item, idx) => (
    <div key={idx} style={{ marginBottom: '8px', paddingLeft: '10px', fontSize: '0.95rem' }}>
      • {item}
    </div>
  ))}
  
  {!userMBTI && (
    <a 
      href="https://kiwimu-mbti.vercel.app?utm_source=moon_island&utm_medium=recommendation&utm_campaign=personalized"
      target="_blank"
      rel="noreferrer"
      style={{ fontSize: '0.8rem', color: '#667eea', marginTop: '10px', display: 'block' }}
    >
      💡 完成 MBTI 測驗，獲得更精準推薦 →
    </a>
  )}
</div>
```

#### 步驟 5：GA4 追踪（1 小時）
```typescript
// 追踪推薦類型
track('view_recommendations', {
  recommendation_type: userMBTI ? 'mbti' : 'mood',
  mbti_type: userMBTI || null,
  mood_state: selectedState,
  recommended_items: recommendedItems
});

// 追踪推薦點擊
track('click_recommendation', {
  recommendation_type: userMBTI ? 'mbti' : 'mood',
  item_name: itemName
});
```

---

### 階段二：行為學習推薦（未來 1-2 個月）

#### 數據基礎建設（2 週）
- [ ] 建立用戶行為追踪表
- [ ] 實作瀏覽、點擊、購買事件記錄
- [ ] 建立商品特徵標籤系統
- [ ] 累積至少 100+ 用戶行為數據

#### 推薦算法開發（2 週）
- [ ] 實作協同過濾算法
- [ ] 實作內容推薦算法
- [ ] 設計混合推薦策略
- [ ] A/B 測試不同算法效果

#### 系統優化（持續）
- [ ] 推薦模型訓練與優化
- [ ] 冷啟動問題處理
- [ ] 推薦結果緩存機制
- [ ] 即時推薦 API

---

## 📈 成功指標 (KPI)

### 推薦系統效果

```
追踪指標：
• 推薦點擊率（CTR）
  - 心情推薦：目標 > 15%
  - MBTI 推薦：目標 > 25%
  - AI 推薦：目標 > 30%

• 推薦轉換率
  - 心情推薦：目標 > 10%
  - MBTI 推薦：目標 > 18%
  - AI 推薦：目標 > 25%

• 推薦準確率
  - 用戶反饋滿意度：目標 > 80%
  - 推薦商品購買率：目標 > 20%
```

### 商業效益

```
追踪指標：
• 客單價提升
  - 目標：+15%（$300 → $345）

• 訂單數增長
  - 目標：+30%（120 單 → 156 單/月）

• 回購率提升
  - 目標：+50%（20% → 30%）

• 用戶滿意度
  - 目標：NPS > 60
```

---

## 🎯 立即行動清單

### 本週執行（MBTI 推薦系統）

- [ ] **Day 1-2：建立 MBTI 配對表**
  - 完成 16 型人格配對邏輯
  - 設計推薦理由文案
  - 確認商品對應關係

- [ ] **Day 2-3：開發推薦功能**
  - 獲取用戶 MBTI 資料
  - 實作推薦邏輯
  - UI 差異化顯示

- [ ] **Day 3：測試與優化**
  - 功能測試（有/無 MBTI）
  - UI/UX 優化
  - GA4 事件追踪

- [ ] **Day 4：上線與監控**
  - 部署到 Vercel
  - 監控效果數據
  - 收集用戶反饋

### 2 週後評估

- [ ] 分析 MBTI 推薦效果
- [ ] 調整配對邏輯（如需要）
- [ ] 決定是否啟動 Layer 3

---

## ❓ 常見問題

### Q1: 如果用戶沒有 MBTI 怎麼辦？

**A**: 回退到心情狀態推薦，並引導用戶完成 MBTI 測驗獲得更精準推薦。

### Q2: MBTI 配對邏輯如何確定？

**A**: 基於：
1. MBTI 人格特質理論
2. 商品特性分析（口味、甜度、複雜度）
3. 用戶測試與反饋調整

### Q3: 如果推薦不準確怎麼辦？

**A**: 
1. 提供「不喜歡」反饋機制
2. 持續優化配對邏輯
3. 引入 Layer 3 行為學習修正

### Q4: 需要多少用戶數據才能啟動 AI 推薦？

**A**: 建議：
- 最少 100 位有購買記錄的用戶
- 最少 500 筆訂單數據
- 每個商品至少 10 次購買記錄

---

## ✅ 總結

### 立即可做（推薦 🔥）

**MBTI 推薦系統 (Layer 2)**
- 投入：1-2 天開發
- 效益：轉換率提升 80%（10% → 18%）
- 難度：中等
- ROI：第一個月回本

### 未來可做

**AI 行為學習 (Layer 3)**
- 投入：1-2 個月開發
- 效益：轉換率再提升 39%（18% → 25%）
- 難度：高
- ROI：需要 3-6 個月累積數據

### 建議行動

**立即啟動 MBTI 推薦系統！**

1. 本週完成開發
2. 2 週後評估效果
3. 根據數據決定是否投入 AI 推薦

---

**最後更新**：2026-01-28  
**負責人**：AI Assistant  
**狀態**：⏳ 等待開發決策
